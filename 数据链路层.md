### 定义  
> (OSI/RM)数据链路层是在物理层提供比特流服务的基础上，建立`相邻结点之间的`的数据链路，通过`差错控制`提供`数据帧`在信道上的`“透明”传输`。  

#### 一、基本概念  
> （1）链路(link)：是一条无源的`点到点`的物理线路`段`，`中间没有任何其他的交换结点`。(一条链路只是一条通路的一个组成部分)	  

> （2）数据链路(data link)：除了物理线路外，还必须有`通信协议`来控制这些数据的传输。若把实现这些协议的`硬件和软件加到链路上`，就构成了数据链路。  
> **数据链路 = 链路 + 协议**  
> * 链路中通信双方的信道使用形式不同，会相应有不同的控制协议  
> 
> 数据链路层使用的信道主要有以下两种类型：  
>> 1·`点对点信道`：使用一对一的点对点通信方式。  
>> 2·`广播信道`：使用一对多的广播通信方式，因此过程比较复杂。广播信道上连接的主机很多，因此必须使用专用的共享信道协议来协调这些主机的数据发送。  
>
> （3）帧(Frame)：数据链路层的数据单位  
![image1](https://github.com/onshero/PCN/blob/picture/各层的数据单位.png)
#### 二、基本功能  
> **（1）封装成帧**：在一段数据的前后分别添加`首部`和`尾部`，确定帧的界限，也就是进行`帧定界`。  
> ![image2](https://github.com/onshero/PCN/blob/picture/封装成帧.png)
>> 方法举例：采用特殊的`控制字符`，例如帧开始符SOH和帧结束符EOT  
>> 正确情况下，受到完整的帧；出错情况下，丢弃不完整的帧  
> 
> **（2）透明传输**  
> 当定界符与数据中的编码重复时，会造成错误的解读。（内容相关性冲突——`不透明`）  
> 解决方法：`字符/字节填充`  
>> 发送端的数据链路层——在内容数据中出现控制字符的前面插入一个`转义字符`，如“ESC”；  
>> 接收端的数据链路层——在将数据送往网络层之前`删除`插入的转义字符  
>> 如果转义字符也在数据当中，那么应在转义字符前也插入一个转义字符。当接受端收到连续的两个转义字符时，就删除其中前`面`那个  
>
> **（3）差错控制**  
> 不“可靠”传输可能出现的问题：
> * 比特差错   10100000 ——&gt; 10100010
> * 帧丢失     3 2 1 ——&gt; 2 1
> * 帧重复     3 2 1 ——&gt; 3 2 2 1
> * 帧失序     3 2 1 ——&gt; 2 3 1
> *一旦发生比特差错，很难自动回复；*  
> *中间通信设备不掌握全部通信内容；*  
> 因此在现有网络实现中，数据链路层只提供`比特差错检测`。  
> 方法：广泛使用`循环冗余检验` `CRC` 方法  
>> 核心运算：`模2除法`——与算术除法类似，但每一位的结果不影响其他位，即不向上借位，所以实际上就是`异或`。  
>> `CRC的原理`  
>>> 在发送端，先把数据划分为`组`。假定每组 k 个比特。
>>> 假设待传送的一组数据 M = 101001 （现在 k=6）。  
>>> 在 M 的后面再添加供差错检测用的 n 位`冗余码`一起发送。  
>>
>> `冗余码的计算`  
>>>  1·移位  
>>> 首先，用二进制的模2运算进行2<sup>n</sup>乘 M 的运算，这相当于在 M 的后面添加 n 个 0。  
>>> 2·求余  
>>> 得到的（k+n）位的数除以事先选好的长度位（n+1）位的除数 P （CRC生成多项式），得出商是Q 而余数是R ，余数R 比除数P 少1位，即R 是n 位。  
>>
>> `帧检验序列 FCS` ——即在数据后面添加上的冗余码  
>>> CRC 和 FCS 并不等同  
>>> CRC——检测方法  
>>> FCS——冗余码  
>>> FSC 可用 CRC 得出，但 CRC 并不是获得 FCS 的唯一方法  
>>
>> `接收端对收到的帧进行 CRC 检验`  
>>> 接收端用收到的数据除以 P  
>>> 若得出的余数 R =0 ，则判断这个帧没有差错，就接受  
>>> 否则判定这个帧有差错，就丢弃  
>>
>> **注意**  
>>> 生成的多项式P 的选取十分关键。（CRC16、CRC32、CRC-CCITT...）  
>>> 只要经过严格的挑选，并使用位数足够多的除数P ，那么出现检测不到的差错的概率就很小。  
>>> 但这种检测方法并不能确定究竟是哪一个或哪几个比特出现了差错。只能做到`无差错接受`。  
>>> 要做到“`可靠传输`”（即发送什么就受到什么）就必须再加上`确认`和`重传`机制。将在TCP层去考虑。
#### 点对点协议 PPP（Point-to—Point Protocol）  
> 最初设计是为了两个通过拨号或专线方式连接起来的对等节点之间数据包传输提供一种封装协议。  
> 传统的拨号上网——用户到ISP的链路使用PPP协议  
> 应满足的需求  
>> 封装、透明、简单的差错检测  
>> 建立链路所需参数的协商  
>> 向上支持多种网络层协议、向下兼容多类型链路  
>> 动态分配网络地址、自动检测连接状态  
>
> 组成  
>> 一个将IP数据报`封装`到串行链路的方法  
>> `链路控制`协议LCP（Link Control Protocol）  
>> `网络控制`协议NCP（Network Control Protocol） 
>
> 五个运行阶段
>> 建立链路（LCP）  
>> 验证（PAP/CHAP）  
>> 网络控制协商（NCP）  
>> 会话维持  
>> 终止PPP  
>
> 封装——PPP协议的帧格式  
>> ![image3](https://github.com/onshero/PCN/blob/picture/PPP协议的帧格式1.png)
>> ![image4](https://github.com/onshero/PCN/blob/picture/PPP协议的帧格式2.png)
>
> 透明传输  
>> `异步传输`：将比特分成小组传输，发送端可随时发送，接收端却不知何时到达——面向字节  
>>> 使用一种特殊字符填充法  
>>> 将信息字段中的每一个`0x7E`字节转变成2字节序列（`0x7D, 0x5E`）。  
>>> 若信息字段中出现一个`0x7D`字节，将其转变成2字节序列（`0x7D, 0x5D`）。  
>>> 若信息字段中出现ASCII码的控制字符（即数值小于 0x20 的字符），则在该字符前加入一个 0x7D 字节，同时将该字符的编码加以改变  
>>
>> `同步传输`：以固定的时钟节拍来发送数据信号。——面向比特  
>>> 协议规定采用硬件来完成比特填充——零比特填充（更快捷）——定界符是0x7E(01111110)  
>>> 在发送端将扫描到的5个连续的1后面填入一个0  
>>> 在接收端将扫描发现的5个连续的1后面的一个0删除  
>
> 差错检测  
>> PPP不提供使用序号和确认的可靠传输  
>> 使用 FCS 来保证无差错接受  
>
> PPP协议的应用
>> 传统的拨号上网  
>>> ![image5](https://github.com/onshero/PCN/blob/picture/PPP协议的应用.png)  
>>
>> 扩展：PPPoE（以太网上的PPP）  
>>> DSL中常用的协议  
>>> 以太网与拨号网络之间的中继协议  
>
#### 广播信道的数据链路层  
> 局域网最主要的特点：网络为一个单位所拥有，且地理范围和站点数目均有限。  
> 目前最常用的局域网络——以太网（Ethernet）  
> (1)局域网的拓扑——广播信道  
>> 集线器——星形网  
>> 干线耦合器——环形网  
>> 匹配电阻——总线网、树形网  
>
> 广播信道除封装、透明、差错外的特殊问题  
>> 身份标识  
>> 信道争用
>
> (2)以太网——两个标准（差别很小）  
>> DIX Ethernet V2 是世界上第一个以太网的规约 1982  
>> IEEE 的 802.3 标准 1983  
>>> * 逻辑链路控制 LIC（Logical Link Control） 子层 并不发挥实际作用，一般不考虑  
>>> * 媒体接入控制 MAC（Medium Access Control） 子层  
>>>> MAC层的硬件地址  
>>>>>在局域网中，“MAC地址” = 适配器地址 = 硬件地址 = 物理地址  
>>>>>> MAC 地址——48 位  
>>>>>>> 前三个字节——IEEE 的注册管理机构 RA 分配给厂家。  
>>>>>>> 后三个字节——由厂家自行指派，称为扩展标识符，必须保证生产出来的适配器没有重复地址。  
>>>>
>>>> MAC的帧封装格式  
>>>>> ![image6](https://github.com/onshero/PCN/blob/picture/MAC%20帧封装格式.png)  
>>>>> 类型字段用来标志上一层使用的是什么格式，以便把收到的MAC帧的数据上交给上一层的这个协议。  
>>>>> 数据字段的正式名称是MAC 客户数据字段  
>>>>>> 最小长度64字节-18字节的首部和尾部=数据字段的最小长度  
>>>>
>>>> 适配器的作用  
>>>>> 网络接口板又称为`通信适配器`（adapter）或`网络接口卡` NIC（Network Interface Card），或“`网卡`”。是MAC协议的实现载体。  
>>>>> ![image7](https://github.com/onshero/PCN/blob/picture/适配器的重要功能.png)  
>>>>
>>>> 适配器检查 MAC 地址  
>>>>> 适配器（网卡）从网络上每收到一个 MAC 帧就首先用硬件检查 MAC 帧中的 MAC 地址。  
>>>>> 如果是发往本站的帧则收下，然后再进行其他的处理。  
>>>>> 否则就将此帧丢弃，不再进行其他的处理。以太网不负责重传丢弃的帧。  
>>>>
>>>> 无效的MAC帧
>>>>> 帧的长度不是整数个字节；  
>>>>> 数据字段的长度不再46—1500字节之间；  
>>>>> MAC 帧长度不在 64—1518 字节之间；  
>>>>> 数据字段的长度与长度字段的值不一致；  
>>>>> 用收到的帧检验序列 FCS 查出有差错；  
>>>>
>
