### 定义  
> (OSI/RM)数据链路层是在物理层提供比特流服务的基础上，建立`相邻结点之间的`的数据链路，通过`差错控制`提供`数据帧`在信道上的`“透明”传输`。  

#### 一、基本概念  
> （1）链路(link)：是一条无源的`点到点`的物理线路`段`，`中间没有任何其他的交换结点`。(一条链路只是一条通路的一个组成部分)	  

> （2）数据链路(data link)：除了物理线路外，还必须有`通信协议`来控制这些数据的传输。若把实现这些协议的`硬件和软件加到链路上`，就构成了数据链路。  
> **数据链路 = 链路 + 协议**  
> * 链路中通信双方的信道使用形式不同，会相应有不同的控制协议  
> 
> 数据链路层使用的信道主要有以下两种类型：  
>> 1·`点对点信道`：使用一对一的点对点通信方式。  
>> 2·`广播信道`：使用一对多的广播通信方式，因此过程比较复杂。广播信道上连接的主机很多，因此必须使用专用的共享信道协议来协调这些主机的数据发送。  
>
> （3）帧(Frame)：数据链路层的数据单位  
![image1](https://github.com/onshero/PCN/blob/picture/各层的数据单位.png)
#### 二、基本功能  
> **（1）封装成帧**：在一段数据的前后分别添加`首部`和`尾部`，确定帧的界限，也就是进行`帧定界`。  
> ![image2](https://github.com/onshero/PCN/blob/picture/封装成帧.png)
>> 方法举例：采用特殊的`控制字符`，例如帧开始符SOH和帧结束符EOT  
>> 正确情况下，受到完整的帧；出错情况下，丢弃不完整的帧  
> 
> **（2）透明传输**  
> 当定界符与数据中的编码重复时，会造成错误的解读。（内容相关性冲突——`不透明`）  
> 解决方法：`字符/字节填充`  
>> 发送端的数据链路层——在内容数据中出现控制字符的前面插入一个`转义字符`，如“ESC”；  
>> 接收端的数据链路层——在将数据送往网络层之前`删除`插入的转义字符  
>> 如果转义字符也在数据当中，那么应在转义字符前也插入一个转义字符。当接受端收到连续的两个转义字符时，就删除其中前`面`那个  
>
> **（3）差错控制**  
> 不“可靠”传输可能出现的问题：
> * 比特差错   10100000 ——&gt; 10100010
> * 帧丢失     3 2 1 ——&gt; 2 1
> * 帧重复     3 2 1 ——&gt; 3 2 2 1
> * 帧失序     3 2 1 ——&gt; 2 3 1
> *一旦发生比特差错，很难自动回复；*  
> *中间通信设备不掌握全部通信内容；*  
> 因此在现有网络实现中，数据链路层只提供`比特差错检测`。  
> 方法：广泛使用`循环冗余检验` `CRC` 方法  
>> 核心运算：`模2除法`——与算术除法类似，但每一位的结果不影响其他位，即不向上借位，所以实际上就是`异或`。  
>> `CRC的原理`  
>>> 在发送端，先把数据划分为`组`。假定每组 k 个比特。
>>> 假设待传送的一组数据 M = 101001 （现在 k=6）。  
>>> 在 M 的后面再添加供差错检测用的 n 位`冗余码`一起发送。  
>>
>> `冗余码的计算`  
>>>  1·移位  
>>> 首先，用二进制的模2运算进行2<sup>n</sup>乘 M 的运算，这相当于在 M 的后面添加 n 个 0。  
>>> 2·求余  
>>> 得到的（k+n）位的数除以事先选好的长度位（n+1）位的除数 P （CRC生成多项式），得出商是Q 而余数是R ，余数R 比除数P 少1位，即R 是n 位。  
>>
>> `帧检验序列 FCS` ——即在数据后面添加上的冗余码  
>>> CRC 和 FCS 并不等同  
>>> CRC——检测方法  
>>> FCS——冗余码  
>>> FSC 可用 CRC 得出，但 CRC 并不是获得 FCS 的唯一方法  
>>
>> `接收端对收到的帧进行 CRC 检验`  
>>> 接收端用收到的数据除以 P  
>>> 若得出的余数 R =0 ，则判断这个帧没有差错，就接受  
>>> 否则判定这个帧有差错，就丢弃  
>>
>> **注意**  
>>> 生成的多项式P 的选取十分关键。（CRC16、CRC32、CRC-CCITT...）  
>>> 只要经过严格的挑选，并使用位数足够多的除数P ，那么出现检测不到的差错的概率就很小。  
>>> 但这种检测方法并不能确定究竟是哪一个或哪几个比特出现了差错。只能做到`无差错接受`。  
>>> 要做到“`可靠传输`”（即发送什么就受到什么）就必须再加上`确认`和`重传`机制。将在TCP层去考虑。
